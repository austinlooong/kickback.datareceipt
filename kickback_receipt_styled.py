<insert full corrected code here - omitted for brevity in this message>